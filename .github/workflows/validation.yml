name: Repository Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  markdown-lint:
    name: Lint Markdown Files
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Markdown Linting
        uses: nosborn/github-action-markdown-cli@v3.3.0
        with:
          files: .
          config_file: .markdownlint.json
          ignore_files: node_modules/

  link-checker:
    name: Check Links
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Link Checker
        uses: lycheeverse/lychee-action@v1
        with:
          args: --verbose --no-progress '**/*.md' '**/*.html'
          fail: true

  python-syntax:
    name: Check Python Syntax
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Check Python Syntax
        run: |
          python -m py_compile PYTHON/Python\ questions/*.py || true
          echo "Python syntax check completed"

  java-syntax:
    name: Check Java Syntax
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
      
      - name: Check Java Syntax
        run: |
          javac -d /tmp JAVA/Question/*.java || true
          echo "Java syntax check completed"

  go-syntax:
    name: Check Go Syntax
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      
      - name: Check Go Syntax
        run: |
          cd Golang/questions
          for file in *.go; do
            go fmt "$file" > /dev/null 2>&1 || true
            gofmt -l "$file" || true
          done
          echo "Go syntax check completed"

  typescript-syntax:
    name: Check TypeScript Syntax
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install TypeScript
        run: npm install -g typescript
      
      - name: Check TypeScript Syntax
        run: |
          cd TypeScript/questions
          for file in *.ts; do
            tsc --noEmit --skipLibCheck "$file" || true
          done
          echo "TypeScript syntax check completed"

  sql-syntax:
    name: Check SQL Syntax
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Check SQL Files
        run: |
          echo "Checking SQL syntax..."
          find SQL/questions -name "*.sql" -type f | while read file; do
            echo "Checking $file"
            # Basic SQL syntax validation (checking for common issues)
            grep -E "^[[:space:]]*--" "$file" > /dev/null && echo "âœ“ Comments found in $file"
          done
          echo "SQL syntax check completed"

  file-structure:
    name: Validate File Structure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Check Required Files
        run: |
          echo "Checking for required files..."
          test -f README.md && echo "âœ“ README.md found"
          test -f CONTRIBUTING.md && echo "âœ“ CONTRIBUTING.md found"
          test -f LICENSE && echo "âœ“ LICENSE found"
          test -f CODE_OF_CONDUCT.md && echo "âœ“ CODE_OF_CONDUCT.md found"
          test -f SECURITY.md && echo "âœ“ SECURITY.md found"
          echo "File structure validation completed"

  trailing-whitespace:
    name: Check Trailing Whitespace
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Check for Trailing Whitespace
        run: |
          ! git grep -I --line-number --extended-regexp '\s+$' -- '*.md' '*.py' '*.java' '*.cpp' '*.c' '*.php' '*.R' '*.rs' '*.go' '*.ts' '*.sql' || echo "Found trailing whitespace"

  repository-stats:
    name: Repository Statistics
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Count Languages and Questions
        run: |
          echo "ðŸ“Š Repository Statistics"
          echo "======================="
          echo "Languages with guides:"
          find . -maxdepth 1 -type d | grep -E "(PYTHON|JAVA|PHP|Golang|TypeScript|SQL|RUST)" | wc -l
          echo ""
          echo "Total practice questions:"
          find . -name "*.py" -path "*/Python*questions/*" | wc -l | xargs echo "Python:"
          find . -name "*.java" -path "*/Question/*" | wc -l | xargs echo "Java:"
          find . -name "*.go" -path "*/questions/*" | wc -l | xargs echo "Go:"
          find . -name "*.ts" -path "*/questions/*" | wc -l | xargs echo "TypeScript:"
          find . -name "*.sql" -path "*/questions/*" | wc -l | xargs echo "SQL:"
          echo ""
          echo "Documentation files:"
          find . -name "*.md" -not -path "./node_modules/*" | wc -l
          echo "âœ… Statistics generated successfully"
